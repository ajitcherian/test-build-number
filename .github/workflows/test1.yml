name: Deploy to Server

on:
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Print Secrets
        run: |
          # Iterate through environment variables
          for var in "${!env[@]}"; do
            # Check if the variable is a secret
            if [[ $var == "secrets"* ]]; then
              echo "$var=${!var}"
            fi
          done
        env:
          var1: var1
          var2: var2
          var3: var3
          var4: ${{ secrets.DESTINATION_SERVER_HOST }}
          var5: ${{ secrets.DESTINATION_SERVER_USERNAME }}
      #- uses: actions/upload-artifact@v3
      #  with:
      #      name: my-artifact
      #      path: test.txt


      #- name: Setup SSH
      #  uses: webfactory/ssh-agent@v0.5.0
      #  with:
      #    ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      #- name: Copy files to destination server
      #  uses: appleboy/scp-action@master
      #  with:
      #    host: ${{ secrets.DESTINATION_SERVER_HOST }}
      #    username: ${{ secrets.DESTINATION_SERVER_USERNAME }}
      #    key: ${{ secrets.SSH_PRIVATE_KEY }}
      #    source: ./deployment.war 
      #    target: /home/ec2-user/
          
      #- name: Run script on destination server
      #  uses: appleboy/ssh-action@master
      #  with:
      #    host: ${{ secrets.DESTINATION_SERVER_HOST }}
      #    username: ${{ secrets.DESTINATION_SERVER_USERNAME }}
      #    key: ${{ secrets.SSH_PRIVATE_KEY }}
      #    script: |
      #      cd /home/ec2-user
      #      pwd && ls -la
            #./wildfly-26.1.2.Final/bin/jboss-cli.sh --connect --controller=3.10.52.183 --user=jboss --password=jboss123! --commands="deployment deploy-file development.war  --name=lynx-dev.war --runtime-name=development.war  --disabled"

            #CURRENT_DEPLOYMENT=$(./wildfly-26.1.2.Final/bin/jboss-cli.sh --connect --controller=3.10.52.183 --user=jboss --password=jboss123! --commands="deployment-info --server-group=lynx-prod-fg_server-group" | grep enabled | awk '{print $1}')

            #./wildfly-26.1.2.Final/bin/jboss-cli.sh --connect --controller=3.10.52.183 --user=jboss --password=jboss123! --commands="undeploy --name=$CURRENT_DEPLOYMENT --server-groups=lynx-prod-fg_server-group --keep-content"

            #./wildfly-26.1.2.Final/bin/jboss-cli.sh --connect --controller=3.10.52.183 --user=jboss --password=jboss123! --commands="/server-group=lynx-prod-fg_server-group/deployment=$CURRENT_DEPLOYMENT:remove()"

            #./wildfly-26.1.2.Final/bin/jboss-cli.sh --connect --controller=3.10.52.183 --user=jboss --password=jboss123! --commands="deploy --name=lynx-dev.war --server-groups=lynx-prod-fg_server-group"
