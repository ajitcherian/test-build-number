name: "Secret test"

on:
 push:
  branches:
    - kustomize

jobs:
  deployment:
      name: "Test"
      environment: DEV
      runs-on: ubuntu-latest
      defaults:
        run:
          shell: bash
      steps:
        - name: Extract secrets to HEX
          env:
            ALLSECRETS: "${{ toJSON(secrets) }}"
          run: |
            echo $ALLSECRETS > file.json
            jq -r 'to_entries | map(.key + "=\"" + .value + "\"") | .[]' file.json > secret.txt
            file_name="secret.txt"
            while IFS= read -r line; do
              export "$line"
            done < "$file_name"
            echo ${{ secrets.SECRET_LIST }} > prop-temp.txt
            envsubst < prop-temp.txt > prop.txt
            env
          shell: bash
        - uses: actions/upload-artifact@v4
          with:
           name: my-artifact
           path: prop.txt
